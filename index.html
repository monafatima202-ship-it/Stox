<!DOCTYPE html>
<html>
<head>
<title>APX ULTRA AI TERMINAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>

body{
 background:radial-gradient(circle,#020617,#000);
 font-family:Segoe UI;
 color:white;
 padding:15px;
}

.header{
 text-align:center;
 font-size:26px;
 color:#38bdf8;
 text-shadow:0 0 20px #38bdf8;
 margin-bottom:20px;
}

.card{
 backdrop-filter:blur(20px);
 background:rgba(2,6,23,0.7);
 border:1px solid rgba(56,189,248,0.3);
 box-shadow:0 0 20px rgba(56,189,248,0.3);
 border-radius:15px;
 padding:15px;
 margin-bottom:15px;
}

button{
 padding:10px 18px;
 border:none;
 border-radius:10px;
 margin:5px;
 font-weight:bold;
 cursor:pointer;
 background:#3b82f6;
 color:white;
}

select,input{
 width:95%;
 padding:10px;
 margin:5px;
 border-radius:10px;
 border:none;
 background:#020617;
 color:white;
}

.signal{
 padding:12px;
 margin:10px 0;
 border-radius:12px;
 background:rgba(2,6,23,0.9);
}

.buy{border-left:5px solid #22c55e;}
.sell{border-left:5px solid #ef4444;}

.hidden{display:none;}

</style>
</head>

<body>

<div class="header">ðŸš€ APX ULTRA AI TERMINAL</div>

<!-- LOGIN -->
<div id="loginBox" class="card">
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button onclick="login()">LOGIN</button>
</div>

<!-- DASH -->
<div id="dash" class="hidden">

<!-- CONTROL -->
<div class="card">
<h3>ðŸŽ› Signal Control</h3>

<select id="pair">
<option>AXP-OTC</option>
<option>PFE-OTC</option>
<option>INTL-OTC</option>
<option>JNJ-OTC</option>
<option>MCD-OTC</option>
<option>BA-OTC</option>
<option>MSFT-OTC</option>
</select>

<button onclick="generateSignal()">Generate Signal</button>
<button onclick="checkResult()">Check Result</button>

<div id="signalBox"></div>
<div id="resultBox"></div>

</div>

<!-- SUMMARY -->
<div class="card">
<h3>ðŸ“Š Performance</h3>
<div id="summary"></div>
</div>

</div>

<script>

const API="https://b.mkapi009.workers.dev";

let currentSignal=null;

let stats={
 total:0,
 win:0,
 loss:0,
 mtg:0
};

// LOGIN
async function login(){

 let r=await fetch(API+"/api/login",{
 method:"POST",
 headers:{ "Content-Type":"application/json" },
 body:JSON.stringify({
 u:user.value,
 p:pass.value
 })
 });

 let j=await r.json();

 if(j.ok){
 loginBox.style.display="none";
 dash.classList.remove("hidden");
 updateSummary();
 }else alert("Login Failed");

}

// MILONGAZI DATA
async function candles(pair){
 let r=await fetch(
 `https://milongazi197.serv00.net/otc.php?pair=${pair}&tf=M1&limit=40`
 );
 let j=await r.json();
 return j.data;
}

// EMA
function EMA(c,p){
 let k=2/(p+1);
 let ema=c[0].close;
 for(let x of c){
 ema=x.close*k+ema*(1-k);
 }
 return ema;
}

// RSI
function RSI(c,p){
 let g=0,l=0;
 for(let i=1;i<p;i++){
 let d=c[i].close-c[i-1].close;
 if(d>0) g+=d;
 else l-=d;
 }
 let rs=g/(l||1);
 return 100-(100/(1+rs));
}

// AI SIGNAL BALANCED
async function generateSignal(){

 let pairSel=document.getElementById("pair").value;

 let c=await candles(pairSel);

 let ema12=EMA(c,12);
 let ema26=EMA(c,26);
 let rsi=RSI(c,14);

 let last=c[c.length-1].close;
 let prev=c[c.length-2].close;

 let dir=null;

 if(ema12>ema26 && rsi>50 && last>prev) dir="CALL";
 if(ema12<ema26 && rsi<50 && last<prev) dir="PUT";

 if(!dir){
 signalBox.innerHTML="No signal now";
 return;
 }

 currentSignal={
 pair:pairSel,
 dir,
 entry:last,
 stage:"ENTRY"
 };

 stats.total++;

 signalBox.innerHTML=`
 <div class="signal ${dir==="CALL"?"buy":"sell"}">
 ${pairSel} â†’ ${dir} â†’ ${last}
 </div>
 `;

 updateSummary();

}

// RESULT + MTG TRACK
async function checkResult(){

 if(!currentSignal) return;

 let c=await candles(currentSignal.pair);
 let last=c[c.length-1].close;

 let win=false;

 if(currentSignal.dir==="CALL" && last>currentSignal.entry) win=true;
 if(currentSignal.dir==="PUT" && last<currentSignal.entry) win=true;

 if(currentSignal.stage==="ENTRY"){

 if(win){
 stats.win++;
 resultBox.innerHTML="WIN ðŸ†";
 currentSignal=null;
 }else{
 currentSignal.stage="MTG";
 currentSignal.entry=last;
 stats.mtg++;
 resultBox.innerHTML="MTG1 ACTIVE";
 }

 }else{

 if(win){
 stats.win++;
 resultBox.innerHTML="MTG WIN ðŸ†";
 }else{
 stats.loss++;
 resultBox.innerHTML="LOSS âŒ";
 }

 currentSignal=null;

 }

 updateSummary();

}

// SUMMARY
function updateSummary(){

 let wr=stats.total?((stats.win/stats.total)*100).toFixed(1):0;

 summary.innerHTML=`
 Total ${stats.total}<br>
 Win ${stats.win}<br>
 Loss ${stats.loss}<br>
 MTG ${stats.mtg}<br>
 WR ${wr}%
 `;

}

</script>

</body>
</html>
