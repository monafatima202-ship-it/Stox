<!DOCTYPE html>
<html>
<head>
<title>APX PREMIUM TERMINAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{background:#020617;color:white;font-family:Segoe UI;padding:15px;}
.header{text-align:center;font-size:26px;color:#38bdf8;text-shadow:0 0 10px #38bdf8;margin-bottom:10px;}
.card{border:1px solid #38bdf8;border-radius:14px;padding:14px;margin-bottom:14px;box-shadow:0 0 10px rgba(56,189,248,.4);}
.btn{width:100%;padding:12px;margin:5px 0;border-radius:10px;border:1px solid #38bdf8;background:#020617;color:#38bdf8;font-weight:bold;}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.scroll{max-height:220px;overflow:auto;}
.signal{border-left:3px solid #38bdf8;padding:8px;margin:5px 0;font-size:14px;}
.bar{height:10px;background:#38bdf8;margin:4px 0;}
.clock{text-align:center;color:#38bdf8;margin-bottom:8px;}
.hidden{display:none;}
</style>
</head>

<body>

<div class="header">üöÄ APX PREMIUM TERMINAL</div>
<div class="clock" id="clock"></div>

<div id="loginBox" class="card">
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button class="btn" onclick="login()">LOGIN</button>
</div>

<div id="dash" class="hidden">

<div class="card">
<div class="grid" id="pairs"></div>
</div>

<div class="card">
<button class="btn" onclick="sendSignal()">üöÄ SEND SIGNAL</button>
<button class="btn" onclick="win()">‚úÖ WIN</button>
<button class="btn" onclick="loss()">‚ùå LOSS</button>
<button class="btn" onclick="mtg()">‚ö† MTG1</button>
</div>

<div class="card">
<h3>üìä Marketing Summary</h3>
<div id="summary"></div>
</div>

<div class="card">
<h3>üìà Win vs Loss Graph</h3>
<div id="graph"></div>
</div>

<div class="card">
<h3>üìä Pair Accuracy</h3>
<div id="pairStats"></div>
</div>

<div class="card scroll">
<h3>ü§ñ Live Feed</h3>
<div id="feed"></div>
</div>

</div>

<script>

const API="https://b.mkapi009.workers.dev";

const PAIRS=[
"AXP-OTC","PFE-OTC","INTL-OTC",
"JNJ-OTC","MCD-OTC","BA-OTC","MSFT-OTC"
];

let selectedPair="";

async function login(){
 let r=await fetch(API+"/api/login",{
 method:"POST",
 headers:{ "Content-Type":"application/json" },
 body:JSON.stringify({u:user.value,p:pass.value})
 });
 let j=await r.json();
 if(j.ok){
 loginBox.style.display="none";
 dash.classList.remove("hidden");
 buildPairs();
 load();
 }
}

function buildPairs(){
 let h="";
 PAIRS.forEach(p=>{
 h+=`<button class="btn" onclick="selectedPair='${p}'">${p}</button>`;
 });
 pairs.innerHTML=h;
}

async function sendSignal(){
 await fetch(API+"/api/manual-signal",{
 method:"POST",
 headers:{ "Content-Type":"application/json" },
 body:JSON.stringify({pair:selectedPair})
 });
 load();
}

async function win(){ await update("WIN üèÜüíö"); }
async function loss(){ await update("LOSS ‚ùå"); }
async function mtg(){ await update("MTG 1 ‚ö†"); }

async function update(r){
 await fetch(API+"/api/update-result",{
 method:"POST",
 headers:{ "Content-Type":"application/json" },
 body:JSON.stringify({result:r})
 });
 load();
}

async function load(){

 let r=await fetch(API+"/api/signals");
 let j=await r.json();

 let total=0, win=0, loss=0, mtg=0;
 let pairMap={};

 let f="";

 j.results.forEach(s=>{

 total++;

 if(!pairMap[s.pair]) pairMap[s.pair]={t:0,w:0};

 pairMap[s.pair].t++;

 if(s.result?.includes("WIN")){ win++; pairMap[s.pair].w++; }
 if(s.result?.includes("LOSS")) loss++;
 if(s.result?.includes("MTG")) mtg++;

 f+=`<div class="signal">
 ${s.pair} | ${s.direction} | ${s.result}
 </div>`;
 });

 feed.innerHTML=f;

 let acc=total?((win/total)*100).toFixed(1):0;

 summary.innerHTML=`
 Total Signals: ${total}<br>
 Wins: ${win}<br>
 Loss: ${loss}<br>
 MTG: ${mtg}<br>
 Accuracy: ${acc}%
 `;

 // GRAPH
 graph.innerHTML=`
 Win<div class="bar" style="width:${win*5}px"></div>
 Loss<div class="bar" style="width:${loss*5}px"></div>
 MTG<div class="bar" style="width:${mtg*5}px"></div>
 `;

 // PAIR STATS
 let ps="";
 Object.keys(pairMap).forEach(p=>{
 let a=((pairMap[p].w/pairMap[p].t)*100).toFixed(1);
 ps+=`${p} ‚Üí ${a}%<br>`;
 });
 pairStats.innerHTML=ps;
}

setInterval(load,7000);

setInterval(()=>{
 let d=new Date(Date.now()+5*60*60*1000);
 clock.innerText="UTC+5: "+d.toLocaleString();
},1000);

</script>

</body>
</html>
